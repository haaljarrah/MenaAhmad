{% extends 'base.html' %}
{% block content %}
<div class="container">
    <h2>Ask a Question</h2>
    <form id="aiForm">
        <div class="mb-3">
            <label for="userQuery" class="form-label">Your Question:</label>
            <input type="text" class="form-control" id="userQuery" name="query" required>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <div class="card mt-3" style="width: 18rem;">
        <div class="card-body">
          <h5 class="card-title">Card title</h5>
          <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
          <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
          <a href="#" class="card-link">Card link</a>
          <a href="#" class="card-link">Another link</a>
        </div>
    </div>
    <div id="responseArea" class="mt-3">
        <!-- Response will be displayed here -->
    </div>
</div>
<div id="questionContainer">
</div>

<script>
    let currentQuestionIndex = 0;
    let answers = [];

    function fetchQuestions() {
        // Placeholder for fetch API call
        let questions = [
            {"text": "What is your favorite color?"},
            {"text": "What is your hobby?"},
            {"text": "What is your dream job?"}
        ];
        displayQuestion(questions);
    }

    function displayQuestion(questions) {
        if (currentQuestionIndex < questions.length) {
            let question = questions[currentQuestionIndex];
            let container = document.getElementById('questionContainer');
            container.innerHTML = `
                <div>
                    <p>${question.text}</p>
                    <input type="text" id="answerInput" placeholder="Type your answer here">
                    <button onclick="saveAnswer(${question.id}, ${questions.length})">Next</button>
                </div>
            `;
        } else {
            displayAllQuestionsAndAnswers(questions);
        }
    }

    function saveAnswer(questionId, totalQuestions) {
        let answerInput = document.getElementById('answerInput').value;
        answers.push({questionId: questionId, answer: answerInput});
        currentQuestionIndex++;
        if (currentQuestionIndex < totalQuestions) {
            fetchQuestions();
        } else {
            submitAnswers();
        }
    }

    function displayAllQuestionsAndAnswers(questions) {
        let container = document.getElementById('questionContainer');
        container.innerHTML = questions.map((question, index) => `
            <div>
                <p>${question.text}</p>
                <input type="text" value="${answers[index].answer}">
                <button onclick="editAnswer(${question.id})">Edit</button>
            </div>
        `).join('');
        container.innerHTML += '<button onclick="submitAnswers()">Submit All</button>';
    }

    function submitAnswers() {
        fetch('/submit_answers', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(answers)
        }).then(response => response.json())
          .then(data => alert('Answers submitted!'));
    }

    // Initial call to fetch questions
    fetchQuestions();

</script>
{% endblock content %}
